<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AnimeStream Pro - 7x Backup</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <!-- YouTube API (Ultimate Backup) -->
    <script src="https://www.youtube.com/iframe_api"></script>
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: #0a0f1f; color: white; font-family: 'Segoe UI', sans-serif; }
        
        .navbar { background: #141b2b; padding: 15px 20px; position: sticky; top: 0; z-index: 100; border-bottom: 2px solid #e50914; }
        .logo { color: #ffd700; font-size: 24px; font-weight: bold; cursor: pointer; }
        
        .bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; background: #141b2b; border-top: 2px solid #e50914; display: flex; justify-content: space-around; padding: 10px 0; z-index: 99; }
        .nav-item { color: #aaa; text-align: center; cursor: pointer; flex: 1; }
        .nav-item.active { color: #ffd700; }
        .nav-item i { font-size: 20px; display: block; margin-bottom: 3px; }
        .nav-item span { font-size: 12px; }
        
        .anime-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 15px; padding: 15px; margin-bottom: 70px; }
        .anime-card { background: #1e2638; border-radius: 10px; overflow: hidden; cursor: pointer; transition: 0.3s; }
        .anime-card:hover { transform: scale(1.03); box-shadow: 0 5px 15px rgba(229, 9, 20, 0.3); }
        .anime-card img { width: 100%; height: 180px; object-fit: cover; }
        .anime-card-content { padding: 10px; }
        .anime-title { font-weight: bold; font-size: 14px; }
        
        .player-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: black; z-index: 1000; display: none; flex-direction: column; }
        .player-header { display: flex; justify-content: space-between; align-items: center; padding: 15px; background: #111; }
        .close-btn { background: #e50914; border: none; color: white; padding: 8px 20px; border-radius: 5px; cursor: pointer; }
        #youtube-player { width: 100%; height: 100%; }
        
        .search-container { padding: 15px; }
        .search-box { background: #1e2638; border-radius: 25px; padding: 10px 15px; display: flex; align-items: center; border: 1px solid #333; }
        .search-box i { color: #ffd700; margin-right: 10px; }
        .search-box input { background: none; border: none; color: white; width: 100%; outline: none; }
        
        .api-status { background: #1e2638; padding: 5px 10px; border-radius: 20px; font-size: 12px; display: inline-block; margin: 5px; }
        .api-status.working { background: #4CAF50; }
        .api-status.failed { background: #ff4444; }
        
        .hide { display: none !important; }
        .loading { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); display: flex; justify-content: center; align-items: center; z-index: 2000; }
        .loading-spinner { width: 50px; height: 50px; border: 5px solid #333; border-top-color: #e50914; border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
    </style>
</head>

    <body>
<!-- Loading -->
<div id="loading" class="loading hide">
    <div class="loading-spinner"></div>
</div>

<!-- Video Player -->
<div class="player-overlay" id="playerOverlay">
    <div class="player-header">
        <h3 id="playerTitle">Now Playing</h3>
        <button class="close-btn" onclick="closePlayer()">Close</button>
    </div>
    <div id="episodes-bar" class="episodes-bar" style="display:flex; overflow-x:auto; padding:10px; background:#1a1a1a; gap:10px;"></div>
    <div id="youtube-player"></div>
</div>

<!-- Top Navbar -->
<div class="navbar">
    <div style="display: flex; justify-content: space-between; align-items: center;">
        <div class="logo" onclick="showSection('home')">üé¨ AnimeStream 7x</div>
        <div id="apiStatus" class="api-status working">API Ready</div>
    </div>
</div>

<!-- Search Box -->
<div class="search-container">
    <div class="search-box">
        <i class="fas fa-search"></i>
        <input type="text" id="searchInput" placeholder="Search anime (e.g., Naruto, One Piece)" onkeyup="searchAnime(this.value)">
    </div>
</div>

<!-- Main Content -->
<div id="mainContent">
    <!-- Home Section -->
    <div id="homeSection">
        <div style="padding: 0 15px;">
            <h2 style="font-size: 20px; margin: 10px 0;">üî• Trending Anime</h2>
            <div id="trendingGrid" class="anime-grid" style="padding: 0;"></div>
            
            <h2 style="font-size: 20px; margin: 10px 0;">üì∫ Popular Anime</h2>
            <div id="animeGrid" class="anime-grid" style="padding: 0 0 70px 0;"></div>
        </div>
    </div>

    <!-- Search Section -->
    <div id="searchSection" class="hide">
        <div style="padding: 0 15px 70px 15px;">
            <h2 style="font-size: 20px; margin-bottom: 15px;">üîç Search Results</h2>
            <div id="searchGrid" class="anime-grid" style="padding: 0;"></div>
        </div>
    </div>
</div>

<!-- Bottom Navigation -->
<div class="bottom-nav">
    <div class="nav-item active" onclick="showSection('home'); setActiveNav(this)">
        <i class="fas fa-home"></i><span>Home</span>
    </div>
    <div class="nav-item" onclick="showSection('search'); setActiveNav(this); document.getElementById('searchInput').focus()">
        <i class="fas fa-search"></i><span>Search</span>
    </div>
</div>

        <script>
// ============================================
// üî• 7 APIs BACKUP SYSTEM
// ============================================

const API_SOURCES = [
    // Tier 1: Fast & Reliable
    {
        name: 'AniWatch',
        search: (q) => `https://aniwatch-api-iy4s.onrender.com/api/search?keyword=${q}`,
        episodes: (id) => `https://aniwatch-api-iy4s.onrender.com/api/episodes/${id}`,
        stream: (id) => `https://aniwatch-api-iy4s.onrender.com/api/stream?id=${id}&type=sub&server=HD-2`,
        priority: 1
    },
    // Tier 2: Consumet GogoAnime
    {
        name: 'GogoAnime',
        search: (q) => `https://api.consumet.org/anime/gogoanime/${q}`,
        episodes: (id) => `https://api.consumet.org/anime/gogoanime/info/${id}`,
        stream: (id) => `https://api.consumet.org/anime/gogoanime/watch/${id}`,
        priority: 2
    },
    // Tier 3: Consumet Zoro
    {
        name: 'Zoro',
        search: (q) => `https://api.consumet.org/anime/zoro/${q}?page=1`,
        episodes: (id) => `https://api.consumet.org/anime/zoro/info?id=${id}`,
        stream: (id) => `https://api.consumet.org/anime/zoro/watch?episodeId=${id}`,
        priority: 3
    },
    // Tier 4: AMVStr√∏m
    {
        name: 'AMVStr√∏m',
        search: (q) => `https://api.amvstr.ml/api/v2/search?q=${q}`,
        episodes: (id) => `https://api.amvstr.ml/api/v2/info/${id}`,
        stream: (id) => `https://api.amvstr.ml/api/v2/stream/${id}`,
        priority: 4
    },
    // Tier 5: Kuroji
    {
        name: 'Kuroji',
        search: (q) => `https://kuroji-api.vercel.app/search/${q}`,
        episodes: (id) => `https://kuroji-api.vercel.app/anime/${id}`,
        stream: (id) => `https://kuroji-api.vercel.app/watch/${id}`,
        priority: 5
    },
    // Tier 6: Zenime
    {
        name: 'Zenime',
        search: (q) => `https://zenime-api.vercel.app/api/search?q=${q}`,
        episodes: (id) => `https://zenime-api.vercel.app/api/anime/${id}`,
        stream: (id) => `https://zenime-api.vercel.app/api/watch/${id}`,
        priority: 6
    },
    // Tier 7: Anify (Last Resort)
    {
        name: 'Anify',
        search: (q) => `https://api.anify.tv/search/anime/${q}`,
        episodes: (id) => `https://api.anify.tv/episodes/${id}`,
        stream: (id) => `https://api.anify.tv/watch/${id}`,
        priority: 7
    }
];

// ============================================
// üî• API MANAGER WITH AUTO-FALLBACK
// ============================================
class AnimeAPI {
    constructor() {
        this.apis = API_SOURCES.sort((a, b) => a.priority - b.priority);
        this.workingApi = null;
        this.apiStatus = {};
    }

    async fetchWithFallback(type, params) {
        // Show loading
        document.getElementById('loading').classList.remove('hide');
        
        // Try all APIs
        for (const api of this.apis) {
            try {
                console.log(`üîÑ Trying ${api.name}...`);
                
                let url;
                if (type === 'search') url = api.search(params.query);
                else if (type === 'episodes') url = api.episodes(params.id);
                else if (type === 'stream') url = api.stream(params.epId);
                
                if (!url) continue;
                
                const controller = new AbortController();
                const timeout = setTimeout(() => controller.abort(), 5000);
                
                const response = await fetch(url, { 
                    signal: controller.signal,
                    headers: { 'Accept': 'application/json' }
                });
                
                clearTimeout(timeout);
                
                if (!response.ok) continue;
                
                const data = await response.json();
                
                // Validate response
                if (this.isValidResponse(type, data)) {
                    console.log(`‚úÖ ${api.name} working!`);
                    this.workingApi = api.name;
                    this.updateStatus(api.name, true);
                    
                    document.getElementById('loading').classList.add('hide');
                    return { success: true, api: api.name, data };
                }
                
            } catch (error) {
                console.log(`‚ùå ${api.name} failed:`, error.message);
                this.updateStatus(api.name, false);
            }
        }
        
        // All APIs failed - use YouTube backup
        console.log('‚ö†Ô∏è All APIs failed, using YouTube backup');
        document.getElementById('loading').classList.add('hide');
        return await this.youtubeBackup(type, params);
    }
    
    isValidResponse(type, data) {
        if (type === 'search') {
            return data && (data.results?.length || data.animes?.length);
        }
        if (type === 'episodes') {
            return data && (data.episodes?.length || data.data?.episodes);
        }
        return true;
    }
    
    async youtubeBackup(type, params) {
        if (type === 'search') {
            const response = await fetch(
                `https://www.googleapis.com/youtube/v3/search?part=snippet&q=${params.query} anime&type=video&maxResults=20&key=AIzaSyBFcjcu0_89rLDOqeotRpPmiYlWAty_RPM`
            );
            const data = await response.json();
            return { success: true, api: 'YouTube', data: data.items || [] };
        }
        return { success: false };
    }
    
    updateStatus(apiName, isWorking) {
        this.apiStatus[apiName] = { working: isWorking, lastChecked: new Date() };
        const statusDiv = document.getElementById('apiStatus');
        if (statusDiv) {
            const workingCount = Object.values(this.apiStatus).filter(s => s.working).length;
            statusDiv.textContent = `${workingCount}/7 APIs Working`;
            statusDiv.className = `api-status ${workingCount > 0 ? 'working' : 'failed'}`;
        }
    }
}

const animeAPI = new AnimeAPI();
let ytPlayer = null;
let currentEpisodes = [];

// ============================================
// üî• YOUTUBE PLAYER
// ============================================
function onYouTubeIframeAPIReady() {
    console.log('YouTube API Ready');
}

function playVideo(videoId, title) {
    if (!videoId) return;
    
    document.getElementById('playerOverlay').style.display = 'flex';
    document.getElementById('playerTitle').textContent = title || 'Now Playing';
    
    if (ytPlayer) {
        ytPlayer.loadVideoById(videoId);
    } else {
        ytPlayer = new YT.Player('youtube-player', {
            videoId: videoId,
            width: '100%',
            height: '100%',
            playerVars: { autoplay: 1, controls: 1 }
        });
    }
}

function closePlayer() {
    document.getElementById('playerOverlay').style.display = 'none';
    if (ytPlayer) ytPlayer.stopVideo();
}

// ============================================
// üî• OPTIMIZED LOAD HOME - FAST LOADING
// ============================================
async function loadHome() {
    const trending = document.getElementById('trendingGrid');
    const popular = document.getElementById('animeGrid');
    
    // Show loading messages
    trending.innerHTML = '<p style="grid-column:1/-1; text-align:center;">Loading trending anime...</p>';
    popular.innerHTML = '<p style="grid-column:1/-1; text-align:center;">Loading popular anime...</p>';
    
    try {
        // Try just 2 APIs first (faster)
        const apisToTry = ['naruto', 'one piece'];
        let results = [];
        
        for (const search of apisToTry) {
            try {
                const result = await animeAPI.fetchWithFallback('search', { query: search });
                if (result.success && result.data) {
                    const items = result.data.results || result.data.animes || result.data || [];
                    results.push(...items.slice(0, 3));
                }
            } catch (e) {
                console.log(`${search} failed, continuing...`);
            }
        }
        
        // If no results from APIs, show sample data instantly
        if (results.length === 0) {
            showSampleData();
            return;
        }
        
        // Remove duplicates
        const uniqueResults = [...new Map(results.map(item => [item.id, item])).values()];
        
        trending.innerHTML = '';
        popular.innerHTML = '';
        
        uniqueResults.slice(0, 6).forEach(anime => {
            trending.appendChild(createAnimeCard(anime));
        });
        
        uniqueResults.slice(6, 12).forEach(anime => {
            popular.appendChild(createAnimeCard(anime));
        });
        
    } catch (error) {
        console.error('Load failed, showing sample data:', error);
        showSampleData();
    }
}

// ============================================
// üî• SAMPLE DATA - SHOWS INSTANTLY
// ============================================
function showSampleData() {
    const trending = document.getElementById('trendingGrid');
    const popular = document.getElementById('animeGrid');
    
    const sampleAnime = [
        { 
            title: 'Naruto', 
            image: 'https://cdn.myanimelist.net/images/anime/13/17405.jpg',
            id: 'naruto' 
        },
        { 
            title: 'One Piece', 
            image: 'https://cdn.myanimelist.net/images/anime/6/73245.jpg',
            id: 'one-piece' 
        },
        { 
            title: 'Demon Slayer', 
            image: 'https://cdn.myanimelist.net/images/anime/1286/99889.jpg',
            id: 'demon-slayer' 
        },
        { 
            title: 'Attack on Titan', 
            image: 'https://cdn.myanimelist.net/images/anime/10/47347.jpg',
            id: 'aot' 
        }
    ];
    
    trending.innerHTML = '';
    popular.innerHTML = '';
    
    sampleAnime.forEach(anime => {
        const card = createAnimeCard(anime);
        trending.appendChild(card.cloneNode(true));
        popular.appendChild(card.cloneNode(true));
    });
}

// ============================================
// üî• SHOW ANIME DETAILS
// ============================================
async function showAnimeDetails(animeId, title) {
    document.getElementById('loading').classList.remove('hide');
    
    const result = await animeAPI.fetchWithFallback('episodes', { id: animeId });
    
    if (result.success) {
        const episodes = result.data.episodes || [];
        const episodesBar = document.getElementById('episodes-bar');
        episodesBar.innerHTML = '';
        
        episodes.slice(0, 20).forEach((ep, i) => {
            const btn = document.createElement('button');
            btn.className = 'episode-btn';
            btn.textContent = `Ep ${i+1}`;
            btn.onclick = () => playVideo(ep.id, `${title} - Ep ${i+1}`);
            episodesBar.appendChild(btn);
        });
        
        alert(`Found ${episodes.length} episodes from ${result.api} API`);
    }
    
    document.getElementById('loading').classList.add('hide');
}

// ============================================
// üî• SEARCH FUNCTION
// ============================================
async function searchAnime(query) {
    if (query.length < 2) return;
    
    document.getElementById('loading').classList.remove('hide');
    const grid = document.getElementById('searchGrid');
    grid.innerHTML = '';
    
    const result = await animeAPI.fetchWithFallback('search', { query });
    
    if (result.success) {
        const items = result.data.results || result.data.animes || result.data || [];
        items.slice(0, 20).forEach(anime => {
            const card = createAnimeCard(anime);
            grid.appendChild(card);
        });
    }
    
    document.getElementById('loading').classList.add('hide');
    showSection('search');
}

// ============================================
// üî• NAVIGATION
// ============================================
function showSection(section) {
    document.getElementById('homeSection').classList.add('hide');
    document.getElementById('searchSection').classList.add('hide');
    document.getElementById(section + 'Section').classList.remove('hide');
    
    if (section === 'home') loadHome();
}

function setActiveNav(element) {
    document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
    element.classList.add('active');
}

// ============================================
// üî• INITIALIZATION
// ============================================
window.onload = () => {
    showSection('home');
    loadHome();
};
</script>
</body>
</html>
